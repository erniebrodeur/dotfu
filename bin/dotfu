#!/usr/bin/env ruby

require 'dotfu'
require 'yaml'


require 'slop'

if !Dotfu.installed?
  puts "Git does not appear to be installed, aporting."
  exit 1
end

opts = Slop.parse(help:true) do
  banner "Dotfu:\n"\
    "DOTFILES is a string that can be user:repo or user@repo.  If no user is "\
    "provided, it will attempt to look one up from the git config file.\n"

  on(:v, :verbose, 'Enable verbose mode')
  on(:version, 'Print the version') {puts "Version #{Dotfu::VERSION}" }
  on(:data_directory, "Root directory to fetch into (default: #{Bini.data_dir}/repos)")
  on(:target_directory, "Change the default target directory from your home: #{Dir.home}")

  # not sure that this is the right dir after install.  Need to determine that.
  Dir.glob("commands/*.rb").each do |file|
    instance_eval open(file).read
  end

  command 'search' do
    banner "Search for a repo globally or in a user's directory."
  end
  command 'clean' do
    banner "Purge any unused files from the cached repos."
  end
  command 'status' do
    banner "Spit out various stats about the cached/installed repos."
  end
end
